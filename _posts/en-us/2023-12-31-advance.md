---
title: Advanced Mode
author: nevstop
date: 2023-12-31
layout: post
lang: en-us
page_id: advance-of-csm
toc: true
---

# Built-in Error Handling Mechanism

The CSM framework provides a built-in error handling mechanism for capturing and handling errors that occur during module operation. Each CSM module automatically broadcasts an `Error Occurred` status update when an error occurs, and any module that has subscribed to this status can capture and handle these errors.

## Working Principle

1. When an error occurs in a CSM module, the error is passed through the error wire into the module
2. The error information triggers the CSM module to transition to the `Error Handler` state
3. In the `Error Handler` state, the error information is thrown through the `Error Occurred` status
4. Any module that has subscribed to the `Error Occurred` status of this module can capture and handle this error

## Global Error Handling

By subscribing to the `Error Occurred` broadcast event of all modules in the main program, a global error handling mechanism can be implemented:

```
Error Occurred@* >> Error Handler -><register>
```

When any CSM submodule throws an `Error Occurred` status change, it will trigger the `Error Handler` state of the main program, which processes the captured event.

## Example

Refer to the example ***/Example/4. Advance Examples/1. Global Error Handling***

# Worker Mode

Worker Mode is an advanced mode in the CSM framework that allows multiple cloneable CSM instances to run as nodes, collectively forming a worker module.

## Working Principle

1. To avoid naming conflicts, worker modules use module names with an appended "#" suffix, informing the CSM framework that this is a worker module
2. When a message is sent to a worker module, it is processed using a fair queue mechanism, and the first available module will handle the message
3. From the outside, the system behaves as if there is only one module running, and all CSM concepts (such as synchronous, asynchronous, and broadcasting) remain unchanged

## Features

- Improves the concurrent processing capability of the system
- Load balancing, automatically distributing messages to available workers
- Appears as a single module from the outside
- Supports dynamic expansion of the number of workers

## Implementation Steps

1. Use advanced VI to mark the CSM module as worker mode (add # as suffix)
2. Asynchronously or synchronously call multiple worker CSM modules
3. Send messages to the worker module, and the system will automatically distribute the messages to available workers
4. When exiting, send `Macro: Exit` messages to all worker modules

## Example

Refer to the example ***/Example/4. Advance Examples/2. Worker Mode***

# Chain of Responsibility Mode

Chain of Responsibility Mode is an advanced mode in the CSM framework that allows multiple CSM modules to process messages in sequence.

## Working Principle

1. Chain CSM modules should always be marked with a suffix "$" and an integer, such as "CSMName$1", "CSMName$2", etc.
2. A group of responsibility chain CSM modules process messages in the allowed way and in sequence:
   - Each individual chain module can only process specifically allowed messages
   - If a message is allowed by multiple chain modules, the chain module with the lowest sequence will process the message, and the message will not be processed by higher sequence chain modules
3. If no module in the chain can process the message, an error will be returned

## Features

- Decouples the sender and receiver of requests
- Allows dynamic combination of processing flows
- Each module only needs to focus on the messages it can process
- Supports flexible adjustment of processing order

## Implementation Steps

1. Add specially allowed messages for each chain module
2. Mark chain modules with a suffix "$" and an integer, such as "Chain$1", "Chain$2", etc.
3. Send messages to the responsibility chain module, and the system will automatically pass the message to the first module that can process it
4. When exiting, send `Macro: Exit` messages to the responsibility chain module

## Example

Refer to the example ***/Example/4. Advance Examples/3. Chain of Responsibility Mode***
